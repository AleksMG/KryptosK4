<!DOCTYPE html>
<html>
<head>
    <title>–í–∑–ª–æ–º—â–∏–∫ —à–∏—Ñ—Ä–∞ –í–∏–∂–µ–Ω–µ—Ä–∞</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        textarea, button { width: 100%; padding: 10px; margin: 5px 0; }
        .result { background: #f5f5f5; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîì –í–∑–ª–æ–º —à–∏—Ñ—Ä–∞ –í–∏–∂–µ–Ω–µ—Ä–∞ (–∞–Ω–∞–ª–æ–≥ Kryptos K4)</h1>
    
    <textarea id="ciphertext" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç..."></textarea>
    <button onclick="crack()">–í–∑–ª–æ–º–∞—Ç—å</button>
    
    <div class="result">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
        <div id="output"></div>
    </div>

    <script>
        // –ê–Ω–≥–ª–∏–π—Å–∫–∞—è —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å –±—É–∫–≤
        const englishFreq = {
            'E': 12.7, 'T': 9.1, 'A': 8.2, 'O': 7.5, 'I': 6.9, 'N': 6.7,
            'S': 6.3, 'H': 6.1, 'R': 6.0, 'D': 4.3, 'L': 4.0, 'C': 2.8
        };

        // –í–∑–ª–æ–º —à–∏—Ñ—Ä–∞ –í–∏–∂–µ–Ω–µ—Ä–∞
        function crack() {
            const ciphertext = document.getElementById("ciphertext").value.toUpperCase().replace(/[^A-Z]/g, "");
            const maxKeyLength = 15; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞
            
            let bestKey = "";
            let bestScore = -1;
            let bestDecrypted = "";

            // –ü–µ—Ä–µ–±–æ—Ä –¥–ª–∏–Ω—ã –∫–ª—é—á–∞ (–º–µ—Ç–æ–¥ –ö–∞–∑–∏—Å–∫–∏)
            for (let keyLen = 1; keyLen <= maxKeyLength; keyLen++) {
                const groups = Array.from({ length: keyLen }, () => []);
                
                // –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –≥—Ä—É–ø–ø—ã
                for (let i = 0; i < ciphertext.length; i++) {
                    groups[i % keyLen].push(ciphertext[i]);
                }

                // –ü–æ–¥–±–∏—Ä–∞–µ–º –∫–ª—é—á –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
                let key = "";
                for (const group of groups) {
                    const freqs = {};
                    for (const c of group) {
                        freqs[c] = (freqs[c] || 0) + 1;
                    }

                    // –ò—â–µ–º –ª—É—á—à–∏–π —Å–¥–≤–∏–≥
                    let bestShift = 0;
                    let bestGroupScore = -1;
                    
                    for (let shift = 0; shift < 26; shift++) {
                        let score = 0;
                        for (const c in freqs) {
                            const decrypted = String.fromCharCode(((c.charCodeAt(0) - 65 - shift + 26) % 26 + 65);
                            score += (englishFreq[decrypted] || 0) * freqs[c];
                        }
                        if (score > bestGroupScore) {
                            bestGroupScore = score;
                            bestShift = shift;
                        }
                    }
                    key += String.fromCharCode(bestShift + 65);
                }

                // –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–∏–º –∫–ª—é—á–æ–º
                let decrypted = "";
                for (let i = 0; i < ciphertext.length; i++) {
                    const shift = key.charCodeAt(i % keyLen) - 65;
                    decrypted += String.fromCharCode((ciphertext.charCodeAt(i) - 65 - shift + 26) % 26 + 65);
                }

                // –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const score = decrypted.split('').filter(c => "ETAOIN".includes(c)).length;
                if (score > bestScore) {
                    bestScore = score;
                    bestKey = key;
                    bestDecrypted = decrypted;
                }
            }

            // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            document.getElementById("output").innerHTML = `
                <p><strong>–ù–∞–π–¥–µ–Ω–Ω—ã–π –∫–ª—é—á:</strong> ${bestKey}</p>
                <p><strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</strong> ${bestDecrypted}</p>
                <p><strong>–ú–µ—Ç–æ–¥:</strong> –ß–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ + –ø–µ—Ä–µ–±–æ—Ä –¥–ª–∏–Ω—ã –∫–ª—é—á–∞</p>
            `;
        }
    </script>
</body>
</html>
