<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–∫–æ–¥–µ—Ä —à–∏—Ñ—Ä–∞ –í–∏–∂–µ–Ω–µ—Ä–∞</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-bottom: 15px;
            min-height: 150px;
            resize: vertical;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        .result-area {
            margin-top: 25px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }
        .settings {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .success {
            color: #27ae60;
        }
        .key-candidate {
            margin: 10px 0;
            padding: 10px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–µ–∫–æ–¥–µ—Ä —à–∏—Ñ—Ä–∞ –í–∏–∂–µ–Ω–µ—Ä–∞</h1>
        
        <div class="settings">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞:</h3>
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞: <span id="keyLengthValue">15</span></p>
            <input type="range" id="keyLength" min="1" max="30" value="15" oninput="document.getElementById('keyLengthValue').textContent = this.value">
        </div>

        <textarea id="ciphertext" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç...">OBKRUOXOGHULBSOLIFBBWFLRVQQPRNGKSSOTWTQSJQSSEKZZWATJKLUDIAWINFBNYPVTTMZFPKWGDKZXTJCDIGKUHUAUEKCAR</textarea>
        
        <button onclick="decode()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        
        <div class="result-area">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞:</h3>
            <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
            <div id="result"></div>
            <div id="candidates"></div>
        </div>
    </div>

    <script>
        // –ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å –±—É–∫–≤ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
        const englishFreq = {
            'A': 8.167, 'B': 1.492, 'C': 2.782, 'D': 4.253, 'E': 12.702,
            'F': 2.228, 'G': 2.015, 'H': 6.094, 'I': 6.966, 'J': 0.153,
            'K': 0.772, 'L': 4.025, 'M': 2.406, 'N': 6.749, 'O': 7.507,
            'P': 1.929, 'Q': 0.095, 'R': 5.987, 'S': 6.327, 'T': 9.056,
            'U': 2.758, 'V': 0.978, 'W': 2.360, 'X': 0.150, 'Y': 1.974,
            'Z': 0.074
        };

        // –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –±–∏–≥—Ä–∞–º–º—ã –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
        const commonBigrams = [
            'TH', 'HE', 'IN', 'ER', 'AN', 'RE', 'ON', 'AT',
            'EN', 'ND', 'TI', 'ES', 'OR', 'TE', 'OF', 'ED'
        ];

        // –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —Å–ª–æ–≤–∞ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
        const commonWords = [
            'THE', 'AND', 'FOR', 'ARE', 'BUT', 'NOT', 'YOU', 'ALL',
            'ANY', 'CAN', 'HER', 'WAS', 'ONE', 'OUR', 'OUT', 'GET',
            'HIS', 'HAS', 'WHO', 'ITS', 'HAD', 'HOW', 'SHE', 'THEY'
        ];

        function decode() {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('result').innerHTML = '';
            document.getElementById('candidates').innerHTML = '';
            document.getElementById('status').innerHTML = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–µ–∫—Å—Ç...';
            
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const maxKeyLength = parseInt(document.getElementById('keyLength').value);
            
            // –ü–æ–ª—É—á–∞–µ–º –∏ –æ—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç
            let ciphertext = document.getElementById('ciphertext').value;
            ciphertext = ciphertext.toUpperCase().replace(/[^A-Z]/g, '');
            
            if (!ciphertext) {
                document.getElementById('status').innerHTML = '<span class="error">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!</span>';
                return;
            }
            
            // –î–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            setTimeout(() => {
                try {
                    const startTime = performance.now();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –ª—É—á—à–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
                    const candidates = findKeyCandidates(ciphertext, maxKeyLength);
                    
                    // –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º —Å –ª—É—á—à–∏–º–∏ –∫–ª—é—á–∞–º–∏
                    const results = candidates.map(candidate => {
                        return {
                            key: candidate.key,
                            decrypted: decryptVigenere(ciphertext, candidate.key),
                            score: evaluateDecryption(decryptVigenere(ciphertext, candidate.key))
                        };
                    });
                    
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–∞—á–µ—Å—Ç–≤—É
                    results.sort((a, b) => b.score - a.score);
                    
                    const endTime = performance.now();
                    
                    // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    if (results.length > 0) {
                        const best = results[0];
                        document.getElementById('status').innerHTML = `
                            <span class="success">–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${((endTime - startTime)/1000).toFixed(2)} —Å–µ–∫.</span>
                        `;
                        
                        document.getElementById('result').innerHTML = `
                            <div class="key-candidate">
                                <p><strong>–õ—É—á—à–∏–π –∫–ª—é—á:</strong> ${best.key}</p>
                                <p><strong>–î–ª–∏–Ω–∞ –∫–ª—é—á–∞:</strong> ${best.key.length}</p>
                                <p><strong>–û—Ü–µ–Ω–∫–∞:</strong> ${best.score.toFixed(2)}</p>
                                <p><strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</strong></p>
                                <div style="background: white; padding: 10px; border-radius: 4px; margin-top: 10px; word-break: break-all;">
                                    ${best.decrypted}
                                </div>
                            </div>
                        `;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                        if (results.length > 1) {
                            let candidatesHTML = '<h4>–î—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–ª—é—á–∏:</h4>';
                            for (let i = 1; i < Math.min(5, results.length); i++) {
                                const r = results[i];
                                candidatesHTML += `
                                    <div class="key-candidate">
                                        <p><strong>–ö–ª—é—á:</strong> ${r.key} (–¥–ª–∏–Ω–∞: ${r.key.length}, –æ—Ü–µ–Ω–∫–∞: ${r.score.toFixed(2)})</p>
                                        <p><strong>–¢–µ–∫—Å—Ç:</strong> ${r.decrypted.substring(0, 50)}...</p>
                                    </div>
                                `;
                            }
                            document.getElementById('candidates').innerHTML = candidatesHTML;
                        }
                    } else {
                        document.getElementById('status').innerHTML = '<span class="error">–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–ª—é—á</span>';
                    }
                } catch (e) {
                    document.getElementById('status').innerHTML = `<span class="error">–û—à–∏–±–∫–∞: ${e.message}</span>`;
                    console.error(e);
                }
            }, 100);
        }

        function findKeyCandidates(ciphertext, maxKeyLength) {
            const candidates = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–ª–∏–Ω—ã –∫–ª—é—á–∞
            for (let keyLen = 1; keyLen <= maxKeyLength; keyLen++) {
                const groups = Array(keyLen).fill().map(() => []);
                
                // –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –≥—Ä—É–ø–ø—ã
                for (let i = 0; i < ciphertext.length; i++) {
                    groups[i % keyLen].push(ciphertext[i]);
                }
                
                // –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞—Ö–æ–¥–∏–º –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–π —Å–¥–≤–∏–≥
                let key = '';
                for (const group of groups) {
                    const freqs = calculateFrequencies(group);
                    const bestShift = findBestShift(freqs);
                    key += String.fromCharCode(bestShift + 65);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                candidates.push({
                    key: key,
                    length: keyLen
                });
            }
            
            return candidates;
        }

        function calculateFrequencies(text) {
            const freqs = {};
            let total = 0;
            
            for (const c of text) {
                freqs[c] = (freqs[c] || 0) + 1;
                total++;
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
            for (const c in freqs) {
                freqs[c] = (freqs[c] / total) * 100;
            }
            
            return freqs;
        }

        function findBestShift(freqs) {
            let bestShift = 0;
            let bestScore = -Infinity;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–¥–≤–∏–≥–∏ (0-25)
            for (let shift = 0; shift < 26; shift++) {
                let score = 0;
                
                // –°—á–∏—Ç–∞–µ–º –æ—Ü–µ–Ω–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–¥–≤–∏–≥–∞
                for (const c in freqs) {
                    const decryptedChar = String.fromCharCode(
                        ((c.charCodeAt(0) - 65 - shift + 26) % 26) + 65
                    );
                    score += (englishFreq[decryptedChar] || 0) * freqs[c];
                }
                
                if (score > bestScore) {
                    bestScore = score;
                    bestShift = shift;
                }
            }
            
            return bestShift;
        }

        function decryptVigenere(ciphertext, key) {
            let decrypted = '';
            const keyLen = key.length;
            
            for (let i = 0; i < ciphertext.length; i++) {
                const cipherChar = ciphertext.charCodeAt(i) - 65;
                const keyChar = key.charCodeAt(i % keyLen) - 65;
                const decryptedChar = (cipherChar - keyChar + 26) % 26;
                decrypted += String.fromCharCode(decryptedChar + 65);
            }
            
            return decrypted;
        }

        function evaluateDecryption(text) {
            let score = 0;
            
            // 1. –ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å –±—É–∫–≤
            const textFreq = calculateFrequencies(text);
            for (const c in textFreq) {
                score += (englishFreq[c] || 0) * textFreq[c] / 100;
            }
            
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–≥—Ä–∞–º–º
            for (let i = 0; i < text.length - 1; i++) {
                const bigram = text.substr(i, 2);
                if (commonBigrams.includes(bigram)) {
                    score += 5;
                }
            }
            
            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–≤
            for (const word of commonWords) {
                if (text.includes(word)) {
                    score += 10 * word.length;
                }
            }
            
            // 4. –®—Ç—Ä–∞—Ñ –∑–∞ —Ä–µ–¥–∫–∏–µ –±—É–∫–≤—ã
            const rareLetters = ['Z', 'Q', 'X', 'J', 'K'];
            for (const c of rareLetters) {
                if (text.includes(c)) {
                    score -= 5;
                }
            }
            
            return score;
        }
    </script>
</body>
</html>
